#!/bin/bash
# Requires: libnotify

limit=20
[ "$1" != "" ] && limit=150

bat_files="/sys/class/power_supply/BAT0"
bat_status=$(cat ${bat_files}/status)
capacity=$(cat "${bat_files}/capacity")
chargenow=$(cat "${bat_files}/charge_now")
chargefull=$(cat "${bat_files}/charge_full")
capacity=$((chargenow*100/chargefull))

if [[ ${bat_status} == "Discharging" && ${capacity} -le ${limit} ]]
then
    echo "Battery alert - ${capacity}%"
    notify-send \
        --icon="$HOME/.local/share/icons/battery_low_dark.png" \
        "Low battery" \
        "Only ${capacity}% battery remaining"
fi
