#!/bin/bash
#
# startgui
#

get_dm_list()
{
  find /usr/share/xsessions/ -type f -exec grep  '^Exec=' {} \; | sed 's/Exec=//g'
  find /usr/share/wayland-sessions/ -type f -exec grep  '^Exec=' {} \; | sed 's/Exec=//g'
}

# already running a dm ?
#[ -n "$DISPLAY" ] && exit

# possible window managers 
# (console plasma i3 i3-gaps enlightenment awesome dwm sway)
declare -a DM_LIST=(console $(get_dm_list))

load_last_dm()
{
  # load last_dm
  LAST_NUM=0
  LAST_DM=console
  [ -f ~/.last_dm ] && LAST_DM=$(cat ~/.last_dm)
  for x in $(seq 0 $((${#DM_LIST[@]}-1)))
  do
    if [ "$LAST_DM" == "${DM_LIST[$x]}" ]
    then
      LAST_NUM=$x
    fi
  done
}

# pick which interface to start
pick_wm()
{
  echo "Pick a desktop"
  echo ""
  for x in $(seq 0 $((${#DM_LIST[@]}-1)))
  do
    if [ "$LAST_NUM" -eq "$x" ]
    then
      echo "${x}) ${DM_LIST[$x]}       <<-- Last Display Manager"
    else
      echo "${x}) ${DM_LIST[$x]}"
    fi
  done
  echo
  echo "Default is the ${DM_LIST[${LAST_NUM}]} [${LAST_NUM}]"
  read -r dm

  if [ "$dm" == "" ]
  then 
    dm=$LAST_NUM
  fi

  echo "${DM_LIST[$dm]}" > ~/.last_dm
}

while :
do
  load_last_dm
  pick_wm

  if [ "${DM_LIST[$dm]}" == "sway" ]
  then
    echo sway
    xbindkeys
    sway
  elif [ "${DM_LIST[$dm]}" != "console" ]
  then
    echo "startx ~/.xinitrc ${DM_LIST[$dm]}"
    startx ~/.xinitrc "${DM_LIST[$dm]}"
  else
    exit
  fi
done

#case $d in
#  0) echo 0;;
#  1) echo startx ~/.xinitrc plasma;;
#  2) echo startx ~/.xinitrc i3;;
#  3) echo startx ~/.xinitrc enlightenment;;
#  4) echo startx ~/.xinitrc awesome;;
#  5) echo startx ~/.xinitrc dwm;;
#  6) echo sway;;
#  *) ;;
#esac




